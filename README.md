# [智械]矩阵 AutoScripting-Matrix
[TOC]



## 简介

这是一个给生存战争带来矩阵电路系统的模组。它与原版传输信号的电路存在些许关联，但是功能却大相径庭。传输内容为矩阵使得你可以用它做一些~~炫酷的~~实用的机械、操作
## 方块介绍
本mod方块分为三大类：
- 源
- 转换器
- 用电器
> 源指可以提供矩阵数据的方块，如`拉杆、按钮`等  
> 转换器指可起到传输作用并且对矩阵进行一些转换操作的方块，如`导线、四维计算板`等
> 用电器指可以利用矩阵产生一些效果的方块，如`方块展示板，实体变换板、矩阵LED`等

---

### 源
| 方块                           | 输入/输出面                                 | 作用                                                         |
| ------------------------------ | ------------------------------------------- | ------------------------------------------------------------ |
| 矩阵源                         | 输出：6端                                   | 输出玩家拟定好的矩阵，初始放置时默认数据为单位阵，破坏后不会丢失数据。 |
| 矩阵开关                       | 输出：前后左右底端                          | 拉杆朝下为关，输出零矩阵；拉杆朝上为开，输出玩家拟定好的矩阵。初始放置时默认数据为单位阵，破坏后不会丢失数据。 |
| 矩阵按钮                       | 输出：前后左右底端                          | 每当按下按钮即输出一个持续约0.10秒的玩家拟定好的矩阵，之后恢复输出零矩阵。初始放置时默认数据为单位阵，破坏后不会丢失数据。 |
| 矩阵源: 世界方块坐标           | 输出：前端                                  | 输出包含本元件所处的坐标的位移矩阵。                         |
| 矩阵源: 玩家变换               | 输入：后端（时钟端） <br /><br />输出：前端 | 输出包含离此元件最近的玩家的世界变换矩阵（包含玩家坐标与旋转）。当时钟端没有接线时，此元件每时每刻输出；而当时钟端接线后，当时钟端输入矩阵M11上升沿（由0开始上升）时，获取一次矩阵并且输出。 |
| 矩阵源: 玩家摄像机视图         | 输入：后端（时钟端） 输出：前端             | 输出最近玩家的摄像机视图矩阵，包含观测的位置，方向，垂直Y方向 **（注意: 若要直接使用此矩阵作为绘制的变换，须对其求逆）**。当时钟端没有接线时，此元件每时每刻输出；而当时钟端接线后，当时钟端输入矩阵M11上升沿（由0开始上升）时，获取一次矩阵并且输出。 |
| 矩阵源: 玩家摄像机投影         | 输出：左右端                                | 输出最近玩家的摄像机投影矩阵，左端输出投影矩阵，右端输出屏幕投影矩阵。 |
| 矩阵源: 从位移创建             | 输入：左后右底端<br /><br />输出：前端      | 创建一个位移矩阵，x为左端（浮点）+下端输入M11，y为下端（浮点）+下端输入M12，z为右端（浮点）+下端输入M13。 |
| 矩阵源: 从欧拉角(三轴旋转)创建 | 输入：左后右底端<br /><br />输出：前端      | 根据欧拉角创建一个旋转矩阵，**采用弧度制！**yaw为左端（浮点）+下端输入M11，pitch为下端（浮点）+下端输入M12，roll为右端（浮点）+下端输入M13。 |
| 矩阵源: 从缩放创建             | 输入：底端<br /><br />输出：前端            | 根据缩放创建一个缩放矩阵。缩放矩阵的三轴缩放皆为输入值。     |
| 矩阵源: 从三轴缩放创建         | 输入：左后右底端<br /><br />输出：前端      | 根据三轴缩放创建一个缩放矩阵。x为左端（浮点）+下端输入M11，y为下端（浮点）+下端输入M12，z为右端（浮点）+下端输入M13。 |
| 矩阵源: 从观察创建             | 输入：左后右端<br /><br />输出：前端        | 详见[矩阵源-从观察创建](#矩阵源-从观察创建)                |
| 矩阵源: 随机常数矩阵           | 输入：后端（时钟端）<br /><br /> 输出：前端 | 输出一个介于0~1的随机常数矩阵。当时钟端没有接线时，此元件每时每刻输出；而当时钟端接线后，当时钟端输入矩阵M11上升沿（由0开始上升）时，获取一次矩阵并且输出。 |
| 二阶方阵转矩阵                 | 输入：前后左右端<br /><br />输出：底端      | 详见[二阶方阵转矩阵](#二阶方阵转矩阵)                        |
| 四维横向量转矩阵               | 输入：前后左右端<br /><br />输出：底端      |  详见[四维横向量转矩阵](#四维横向量转矩阵)                           |
| 浮点转四维横向量               | 输入：前后左右端<br /><br />输出：底端      |                                                              |
| 矩阵源: 从正交投影创建         | 输入：前后左右端 <br /><br />输出：底端     | 输出一个正交投影矩阵。上端（浮点）和右端（浮点）分别代表投影平面的宽度和高度，下端（浮点）和左端（浮点）分别代表近裁剪面和远裁剪面的距离。 |
| 矩阵源: 从透视投影创建         | 输入：前后左右端 <br /><br />输出：底端     | 输出一个透视投影矩阵。上端（浮点）和右端（浮点）分别代表垂直视角的视野范围和宽高比，下端（浮点）和左端（浮点）分别代表近裁剪面和远裁剪面的距离。 |
| 矩阵源: 实时钟               | 输入：底端<br /><br />输出：前后左右端      |   详见[矩阵源-实时钟](#矩阵源-实时钟)                               |


#### 矩阵源-从观察创建

创建一个观察矩阵。其中左端输入摄像机位置（三维向量），后端输入目标位置（三维向量），右端输入向上方向（三维向量）。

- 摄像机位置：表示相机的位置，即相机所在的坐标点。
- 目标位置：表示相机要观察的目标位置，即相机要对准的物体的坐标点。
- 向上方向：表示相机的上方向向量，用于确定相机的方向。通常情况下，up向量应该垂直于相机的观察方向向量，确保相机的朝向是正确的。在这个元件种，up向量会被重新计算，以确保它与相机的观察方向向量和右方向向量垂直。

#### 二阶方阵转矩阵

将四个输入端输入的二阶方阵转为四阶方阵。

$$上端\begin{bmatrix}T & T \\\\\\ T & T\end{bmatrix}右端\begin{bmatrix}R & R \\\\\\ R & R\end{bmatrix}下端\begin{bmatrix}B & B \\\\\\ B & B\end{bmatrix}左端\begin{bmatrix}L & L \\\\\\ L & L\end{bmatrix}→输出\begin{bmatrix}T & T & R & R \\\\\\ T & T & R & R \\\\\\ B & B & L & L \\\\\\ B & B & L & L \end{bmatrix}$$

#### 四维横向量转矩阵


#### 矩阵源-实时钟


------

### 转换器
> 注: 一些转换器有标注“点对点”，它们的运算逻辑为将矩阵的每个对应元素分别计算或转换的结果，再返回由这些结果组成的新矩阵。此种转换模型应与一般的矩阵转换模式区别开。
> (点对点转换器与一般的转换器在模型上也会有些许区别)
#### 导线：

| 方块       | 输入/输出面                | 作用                                                         |
| ---------- | -------------------------- | ------------------------------------------------------------ |
| 矩阵导线   | 输入：6端  输出：6端       | 传输矩阵数据，导线交汇处计算为加法。不同颜色导线不会互相连接。 |
| 矩阵继电器 | 输入：左右后端  输出：前端 | 当左或右面输入矩阵M11大于0时，输出后端输入的矩阵，否则输出0矩阵。 |
#### 处理器：

| 方块 | 输入/输出面 | 作用 |
| ---- | ----------- | ---- |
#### 计算器：

| 方块 | 输入/输出面 | 作用 |
| ---- | ----------- | ---- |
#### 解构器：
| 方块               | 输入/输出面                                         | 作用                                                         |
| ------------------ | --------------------------------------------------- | ------------------------------------------------------------ |
| 矩阵TO解构器       | 输入：底端  输出：左端（1点）右端（2点）            | 将输入矩阵提取其位移矩阵与取向矩阵，并在左端输出位移矩阵（T），右端输出取向矩阵（O）。 |
| 矩阵TRS解构器      | 输入：底端  输出：左端（1点）顶端（2点）右端（3点） | 将输入矩阵提取其位移、旋转（欧拉角）与缩放，并在左端输出位移（三维向量），上端输出旋转（弧度制欧拉角），右端输出缩放（三维向量）。 |
| 矩阵RUF(XYZ)解构器 | 输入：底端  输出：左端（1点）顶端（2点）右端（3点） | 将经过输入矩阵变换后的的X单位向量，Y单位向量，Z单位向量分别输出至左端，上端，右端。 |

---

### 用电器
| 方块          | 输入/输出面                  | 作用                                                         |
| ------------- | ---------------------------- | ------------------------------------------------------------ |
| 实体变换板    | 输入：左端（1点）右端（2点） | 将触碰到的实体变换按照左端输入矩阵进行映射并返回给实体，而实体的速度按照右端输入矩阵进行映射并返回给实体。掉落物同理。 |
| 复杂摄像机LED | 输入：前后左右端             | 详见[复杂摄像机LED](#复杂摄像机LED)                          |
#### 复杂摄像机LED

创建一个摄像机，并且将摄像机捕捉到的画面显示出来。

**输入：**

| 端口 | 作用                                             | 详细                                                         |
| ---- | ------------------------------------------------ | :----------------------------------------------------------- |
| 前   | 摄像机视角矩阵，即摄像机方位、旋转               |                                                              |
| 右   | 摄像机投影矩阵，即摄像机绘制画面所采用的投影矩阵 | 一般采用透视矩阵或正交矩阵                                   |
| 后   | 显示屏变换矩阵                                   | 默认显示屏位置为位于方块中心、朝向为正上方的正方形。此矩阵为这个正方形显示屏的四个端点的变换。（无法显示画面则可能因为这个输入未到位） |
| 左   | 控制矩阵                                         | 详见下方“**控制矩阵**”                                       |

**控制矩阵：**

- M11：画面是否自适应显示，即不会被拉伸（M11>0：是，反之否）
