- # [智械]矩阵 AutoScripting-Matrix

  <!-- TOC -->
  * [[智械]矩阵 AutoScripting-Matrix](#智械矩阵-autoscripting-matrix)
    * [简介](#简介)
    * [方块介绍](#方块介绍)
      * [源](#源)
        * [矩阵源-从观察创建](#矩阵源-从观察创建)
        * [二阶方阵转矩阵](#二阶方阵转矩阵)
        * [四维横向量转矩阵](#四维横向量转矩阵)
        * [矩阵源-实时钟](#矩阵源-实时钟)
      * [转换器](#转换器)
        * [导线](#导线)
        * [处理器](#处理器)
        * [计算器](#计算器)
        * [解构器](#解构器)
      * [用电器](#用电器)
        * [复杂摄像机LED](#复杂摄像机led)
        <!-- TOC -->

  

  ## 简介

  这是一个给生存战争带来矩阵电路系统的模组。它与原版传输信号的电路存在些许关联，但是功能却大相径庭。传输内容为矩阵使得你可以用它做一些~~炫酷的~~实用的机械、操作

  ## 方块介绍

  本mod方块分为三大类：

  - 源
  - 转换器
  - 用电器

  > 源指可以提供矩阵数据的方块，如`拉杆、按钮`等  
  > 转换器指可起到传输作用并且对矩阵进行一些转换操作的方块，如`导线、四维计算板`等
  > 用电器指可以利用矩阵产生一些效果的方块，如`方块展示板，实体变换板、矩阵LED`等

  ---

  ### 源

  | 方块                           | 输入/输出面                                 | 作用                                                                                                                                |
  | ------------------------------ | ------------------------------------------- |-----------------------------------------------------------------------------------------------------------------------------------|
  | 矩阵源                         | 输出：6端                                   | 输出玩家拟定好的矩阵，初始放置时默认数据为单位阵，破坏后不会丢失数据。<br /><br />可通过对话框编辑内容。                                                                        |
  | 矩阵开关                       | 输出：前后左右底端                          | 拉杆朝下为关，输出零矩阵；拉杆朝上为开，输出玩家拟定好的矩阵。初始放置时默认数据为单位阵，破坏后不会丢失数据。<br /><br />可通过对话框编辑内容。                                                    |
  | 矩阵按钮                       | 输出：前后左右底端                          | 每当按下按钮即输出一个持续约0.10秒的玩家拟定好的矩阵，之后恢复输出零矩阵。初始放置时默认数据为单位阵，破坏后不会丢失数据。<br /><br />可通过对话框编辑内容。                                            |
  | 矩阵源: 世界方块坐标           | 输出：前端                                  | 输出包含本元件所处的坐标的位移矩阵。                                                                                                                |
  | 矩阵源: 玩家变换               | 输入：后端（时钟端） <br /><br />输出：前端 | 输出包含离此元件最近的玩家的世界变换矩阵（包含玩家坐标与旋转）。当时钟端没有接线时，此元件每时每刻输出；而当时钟端接线后，当时钟端输入矩阵M11上升沿（由0开始上升）时，获取一次矩阵并且输出。                                  |
  | 矩阵源: 玩家摄像机视图         | 输入：后端（时钟端）<br /><br /> 输出：前端 | 输出最近玩家的摄像机视图矩阵，包含观测的位置，方向，垂直Y方向 **（注意: 若要直接使用此矩阵作为绘制的变换，须对其求逆）**。当时钟端没有接线时，此元件每时每刻输出；而当时钟端接线后，当时钟端输入矩阵M11上升沿（由0开始上升）时，获取一次矩阵并且输出。 |
  | 矩阵源: 玩家摄像机投影         | 输出：左右端                                | 输出最近玩家的摄像机投影矩阵，左端输出投影矩阵，右端输出屏幕投影矩阵。                                                                                               |
  | 矩阵源: 从位移创建             | 输入：左后右底端<br /><br />输出：前端      | 创建一个位移矩阵，x为左端（浮点）+底端输入M11，y为后端（浮点）+底端输入M12，z为右端（浮点）+底端输入M13。                                                                      |
  | 矩阵源: 从欧拉角(三轴旋转)创建 | 输入：左后右底端<br /><br />输出：前端      | 根据欧拉角创建一个旋转矩阵，**采用弧度制！** yaw为左端（浮点）+底端输入M11，pitch为后端（浮点）+底端输入M12，roll为右端（浮点）+底端输入M13。                                             |
  | 矩阵源: 从缩放创建             | 输入：底端<br /><br />输出：前端            | 根据缩放创建一个缩放矩阵。缩放矩阵的三轴缩放皆为输入值。                                                                                                      |
  | 矩阵源: 从三轴缩放创建         | 输入：左后右底端<br /><br />输出：前端      | 根据三轴缩放创建一个缩放矩阵。x为左端（浮点）+底端输入M11，y为后端（浮点）+底端输入M12，z为右端（浮点）+底端输入M13。                                                                |
  | 矩阵源: 从观察创建             | 输入：左后右端<br /><br />输出：前端        | 详见[矩阵源-从观察创建](#矩阵源-从观察创建)                                                                                                         |
  | 矩阵源: 随机常数矩阵           | 输入：后端（时钟端）<br /><br /> 输出：前端 | 输出一个介于0~1的随机常数矩阵。当时钟端没有接线时，此元件每时每刻输出；而当时钟端接线后，当时钟端输入矩阵M11上升沿（由0开始上升）时，获取一次矩阵并且输出。                                                 |
  | 二阶方阵转矩阵                 | 输入：前后左右端<br /><br />输出：底端      | 详见[二阶方阵转矩阵](#二阶方阵转矩阵)                                                                                                             |
  | 四维横向量转矩阵               | 输入：前后左右端<br /><br />输出：底端      | 详见[四维横向量转矩阵](#四维横向量转矩阵)                                                                                                           |
  | 浮点转四维横向量               | 输入：前后左右端<br /><br />输出：底端      | 输出一个四维向量(x, y, z, w)。x：前端；y：右端；z：后端；w：左端。各输入端口都为浮点。                                                                               |
  | 矩阵源: 从正交投影创建         | 输入：前后左右端 <br /><br />输出：底端     | 输出一个正交投影矩阵。前端（浮点）和右端（浮点）分别代表投影平面的宽度和高度，后端（浮点）和左端（浮点）分别代表近裁剪面和远裁剪面的距离。                                                             |
  | 矩阵源: 从透视投影创建         | 输入：前后左右端 <br /><br />输出：底端     | 输出一个透视投影矩阵。前端（浮点）和右端（浮点）分别代表垂直视角的视野范围和宽高比，后端（浮点）和左端（浮点）分别代表近裁剪面和远裁剪面的距离。                                                          |
  | 矩阵源: 实时钟                 | 输入：底端<br /><br />输出：前后左右端      | 详见[矩阵源-实时钟](#矩阵源-实时钟)                                                                                                             |


  #### 矩阵源-从观察创建

  创建一个观察矩阵。其中左端输入摄像机位置（三维向量），后端输入目标位置（三维向量），右端输入向上方向（三维向量）。

  - 摄像机位置：表示相机的位置，即相机所在的坐标点。
  - 目标位置：表示相机要观察的目标位置，即相机要对准的物体的坐标点。
  - 向上方向：表示相机的上方向向量，用于确定相机的方向。通常情况下，up向量应该垂直于相机的观察方向向量，确保相机的朝向是正确的。在这个元件种，up向量会被重新计算，以确保它与相机的观察方向向量和右方向向量垂直。

  #### 二阶方阵转矩阵

  将四个输入端输入的二阶方阵转为四阶方阵。

  $$
  上端\begin{bmatrix}T _ {11} & T _ {12} \\\\\\ T _ {21} & T _ {22}\end{bmatrix}右端\begin{bmatrix}R _ {11} & R _ {12} \\\\\\ R _ {21} & R _ {22}\end{bmatrix}下端\begin{bmatrix}B _ {11} & B _ {12} \\\\\\ B _ {21} & B _ {22}\end{bmatrix}左端\begin{bmatrix}L _ {11} & L _ {12} \\\\\\ L _ {21} & L _ {22}\end{bmatrix}→输出\begin{bmatrix}T _ {11} & T _ {12} & R _ {11} & R _ {12} \\\\\\ T _ {21} & T _ {22} & R _ {21} & R _ {22} \\\\\\ B _ {11} & B _ {12} & L _ {11} & L _ {12} \\\\\\ B _ {21} & B _ {22} & L _ {21} & L _ {22} \end{bmatrix}
  $$

  #### 四维横向量转矩阵

  将四个输入端输入的横向量并成四阶方阵。

  $$
  上端\begin{pmatrix}T _ {11} & T _ {12} & T _ {13} & T _ {14}\end{pmatrix}右端\begin{pmatrix}R _ {11} & R _ {12} & R _ {13} & R _ {14}\end{pmatrix}下端\begin{pmatrix}B _ {11} & B _ {12} & B _ {13} & B _ {14}\end{pmatrix}左端\begin{pmatrix}L _ {11} & L _ {12} & L _ {13} & L _ {14}\end{pmatrix}→输出\begin{bmatrix}T _ {11} & T _ {12} & T _ {13} & T _ {14} \\\\\\ R _ {11} & R _ {12} & R _ {13} & R _ {14} \\\\\\ B _ {11} & B _ {12} & B _ {13} & B _ {14} \\\\\\ L _ {11} & L _ {12} & L _ {13} & L _ {14} \end{bmatrix}
  $$


  #### 矩阵源-实时钟

  根据控制矩阵输出实时时间。

  **输入：**

  | 端口 | 作用     | 详细                   |
  | ---- | -------- | :--------------------- |
  | 前   | 输出时间 | 为常数矩阵             |
  | 右   | 输出时间 | 为常数矩阵             |
  | 后   | 输出时间 | 为常数矩阵             |
  | 左   | 输出时间 | 为常数矩阵             |
  | 底   | 控制矩阵 | 详见下方“**控制矩阵**” |

  **控制矩阵：**

  - ⌊M11⌋=0

    | 端口 | 输出（系统时间） |
    | ---- | ---------------- |
    | 前   | 毫秒             |
    | 右   | 秒               |
    | 后   | 分               |
    | 左   | 时               |

  - ⌊M11⌋=1

    | 端口 | 输出（系统时间） |
    | ---- | ---------------- |
    | 前   | 星期             |
    | 右   | 天               |
    | 后   | 月               |
    | 左   | 年               |

  - ⌊M11⌋=2

    | 端口 | 输出（游戏世界时间） |
    | ---- | -------------------- |
    | 前   | 秒                   |
    | 右   | 分                   |
    | 后   | 时                   |
    | 左   | 天                   |


  ------


  ### 转换器

  > 注: 一些转换器有标注“点对点”，它们的运算逻辑为将矩阵的每个对应元素分别计算或转换的结果，再返回由这些结果组成的新矩阵。此种转换模型应与一般的矩阵转换模式区别开。
  > (点对点转换器与一般的转换器在模型上也会有些许区别)

  #### 导线

  | 方块       | 输入/输出面                | 作用                                                         |
  | ---------- | -------------------------- | ------------------------------------------------------------ |
  | 矩阵导线   | 输入：6端  输出：6端       | 传输矩阵数据，导线交汇处计算为加法。不同颜色导线不会互相连接。 |
  | 矩阵继电器 | 输入：左右后端  输出：前端 | 当左或右面输入矩阵M11大于0时，输出后端输入的矩阵，否则输出0矩阵。 |

  #### 处理器

  **非点对点：**

  | 方块             | 作用                                                         |
  | ---------------- | ------------------------------------------------------------ |
  | 矩阵求逆         | 求输入矩阵的逆矩阵。                                         |
  | 矩阵转置         | 转置输入矩阵并输出。                                         |
  | 矩阵二次方       | 按照矩阵乘法法则，将输入矩阵乘它本身。                       |
  | 矩阵三次方       | 按照矩阵乘法法则，将输入矩阵乘它本身再乘它本身。             |
  | 矩阵转平均浮点数 | 将矩阵内每一个非0元素相加再除以非0元素的个数，将所得浮点数结果输出。 |
  | 浮点数转常数矩阵 | 输出一个内部元素全为输入浮点数的矩阵。                       |
  | 矩阵转三维横向量 | 输出一个三维向量，内容是输入矩阵M11，M12，M13的值。          |
  | 矩阵提取取向     | 求输入矩阵的取向矩阵。                                       |
  | 矩阵提取平移     | 求输入矩阵的平移矩阵。                                       |
  | 矩阵求行列式     | 求输入矩阵的行列式，输出浮点数。                             |

  **点对点：**

  | 方块       | 作用                                  |
  | ---------- |-------------------------------------|
  | 矩阵弧度转角度   | 依据点对点计算，将输入矩阵内所有元素转为角度制。**（使用弧度制）** |
  | 矩阵角度转弧度   | 依据点对点计算，将输入矩阵内所有元素转为弧度制。**（使用角度制）** |
  | 矩阵正弦   | 依据点对点计算，将输入矩阵内所有元素求正弦值。**（使用弧度制）**  |
  | 矩阵余弦   | 依据点对点计算，将输入矩阵内所有元素求余弦值。**（使用弧度制）**  |
  | 矩阵正切   | 依据点对点计算，将输入矩阵内所有元素求正切值。**（使用弧度制）**  |
  | 矩阵反正弦 | 依据点对点计算，将输入矩阵内所有元素求反正弦值。**（使用弧度制）** |
  | 矩阵反余弦 | 依据点对点计算，将输入矩阵内所有元素求反余弦值。**（使用弧度制）** |
  | 矩阵反正切 | 依据点对点计算，将输入矩阵内所有元素求反正切值。**（使用弧度制）** |

  #### 计算器

  **非点对点**

  | 方块       | 作用                                                     |
  | ---------- | -------------------------------------------------------- |
  | 矩阵乘法器 | 按照矩阵乘法法则，将输入矩阵相乘。                       |
  | 矩阵除法器 | 按照矩阵乘法法则，将左端输入矩阵乘右端输入矩阵的逆矩阵。 |

  **点对点**

  | 方块       | 作用（ML代替“左端输入矩阵各元素“，MR代替“右端输入矩阵各元素“） |
  | ---------- | ------------------------------------------------------------ |
  | 矩阵加法器 | ML + MR                                                      |
  | 矩阵减法器 | ML - MR                                                      |
  | 矩阵乘法器 | ML * MR                                                      |
  | 矩阵除法器 | ML / MR                                                      |
  | 矩阵乘方器 | ML ^ MR                                                      |
  | 矩阵除余器 | ML % MR                                                      |
  | 矩阵对数器 | ln(ML) / ln(MR)                                              |
  | 矩阵取小器 | min(ML, MR)                                                  |
  | 矩阵取大器 | max(ML, MR)                                                  |

  #### 解构器

  | 方块               | 输入/输出面                                                  | 作用                                                         |
  | ------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | 矩阵TO解构器       | 输入：底端  <br /><br />输出：左端（1点）右端（2点）         | 将输入矩阵提取其位移矩阵与取向矩阵，并在左端输出位移矩阵（T），右端输出取向矩阵（O）。 |
  | 矩阵TRS解构器      | 输入：底端  <br /><br />输出：左端（1点）顶端（2点）右端（3点） | 将输入矩阵提取其位移、旋转（欧拉角）与缩放，并在左端输出位移（三维向量），上端输出旋转（弧度制欧拉角），右端输出缩放（三维向量）。 |
  | 矩阵RUF(XYZ)解构器 | 输入：底端  <br /><br />输出：左端（1点）顶端（2点）右端（3点） | 将经过输入矩阵变换后的的X单位向量，Y单位向量，Z单位向量分别输出至左端，上端，右端。 |
  | 矩阵转二阶方阵     | 输入：底端<br /><br />输出：前后左右端                       | 与“[二阶方阵转矩阵](#二阶方阵转矩阵)”相反。                    |
  | 矩阵转四维横向量   | 输入：底端<br /><br />输出：前后左右端                       | 与“[四维横向量转矩阵](#四维横向量转矩阵)”相反。                |
  | 四维横向量转浮点   | 输入：底端<br /><br />输出：前后左右端                       | 解构输入四维向量(x, y, z, w)。x：前端输出；y：右端输出；z：后端输出；w：左端输出。各出端口都为浮点。 |

  ---

  ### 用电器

  | 方块          | 输入/输出面                  | 作用                                                         |
  | ------------- | ---------------------------- | ------------------------------------------------------------ |
  | 实体变换板    | 输入：左端（1点）右端（2点） | 将触碰到的实体变换按照左端输入矩阵进行映射并返回给实体，而实体的速度按照右端输入矩阵进行映射并返回给实体。掉落物同理。 |
  | 复杂摄像机LED | 输入：前后左右端             | 详见[复杂摄像机LED](#复杂摄像机LED)                          |

  #### 复杂摄像机LED

  创建一个摄像机，并且将摄像机捕捉到的画面显示出来。

  **输入：**

  | 端口 | 作用                                             | 详细                                                         |
  | ---- | ------------------------------------------------ | :----------------------------------------------------------- |
  | 前   | 摄像机视角矩阵，即摄像机方位、旋转               |                                                              |
  | 右   | 摄像机投影矩阵，即摄像机绘制画面所采用的投影矩阵 | 一般采用透视矩阵或正交矩阵                                   |
  | 后   | 显示屏变换矩阵                                   | 默认显示屏位置为位于方块中心、朝向为正上方的正方形。此矩阵为这个正方形显示屏的四个端点的变换。（无法显示画面则可能因为这个输入未到位） |
  | 左   | 控制矩阵                                         | 详见下方“**控制矩阵**”                                       |

  **控制矩阵：**

  - M11：画面是否自适应显示，即不会被拉伸（M11>0：是，反之否）
